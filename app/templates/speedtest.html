{% extends 'base.html' %}
{% block content %}
<div class="card">
  <h2>Speedtest</h2>
  <form method="post">
    <p>This uses speedtest.net servers via speedtest-cli. It may take up to a minute and uses bandwidth.</p>
    <button type="submit">Run Speedtest</button>
  </form>
  {% if result %}
    <h3>Results</h3>
    <ul>
      <li>Download: <strong style="color:#60a5fa">{{ result.download_mbps }} Mbps</strong></li>
      <li>Upload: <strong style="color:#a78bfa">{{ result.upload_mbps }} Mbps</strong></li>
      <li>Ping: <strong>{{ result.ping_ms }} ms</strong></li>
      <li>Server: {{ result.server.sponsor }} â€” {{ result.server.name }} ({{ result.server.country }})</li>
    </ul>
    <canvas id="speedChart" data-dl="{{ result.download_mbps }}" data-ul="{{ result.upload_mbps }}" height="120"></canvas>
  {% endif %}
  {% if error %}
    <pre>{{ error }}</pre>
  {% endif %}
</div>
{% if result %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
<script>
(function(){
  const cvs = document.getElementById('speedChart');
  const dl = parseFloat(cvs.dataset.dl || '0');
  const ul = parseFloat(cvs.dataset.ul || '0');
  new Chart(cvs, {
    type: 'bar',
    data: { labels: ['Download','Upload'], datasets: [{ label: 'Mbps', data: [dl, ul], backgroundColor: ['#60a5fa','#a78bfa'] }] },
    options: { plugins: { legend: { display: false } }, scales: { y: { beginAtZero:true } } }
  });
})();
</script>
{% endif %}
{% endblock %}
